<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAAjU0EJWnWPMv7oQ-jjS7dYxSPW5CJgpdgO_s4yyMovOaVh_KvvhSfpvagV18eOyDWu7VytS6Bi1CWxw"
      type="text/javascript"></script>
    <style type="text/css">
    v\:* {
      behavior:url(#default#VML);
    }
    </style>
    <script type="text/javascript"> 
   
    var map;

function onLoad() {
  if (GBrowserIsCompatible()) {
    map = new GMap2(document.getElementById("map")); 
    map.addControl(new GLargeMapControl());
    map.setCenter(new GLatLng(37.26, -112.949), 10); 
    map.addControl(new GLargeMapControl());
    var albumUrl = "http://picasaweb.google.com/data/feed/base/user/kevin.smilak/albumid/4974033316286300177?kind=photo";

//    var albumUrl = "http://picasaweb.google.com/data/feed/base/user/picasateam/albumid/5080138758345059425?kind=photo";
    var geoXml = new GGeoXml(albumUrl + "&alt=kml&hl=en_US");
    map.addOverlay(geoXml);
    getJSON(albumUrl);
  }
} 

/**
 * Creates a script tag in the page that loads in the 
 * JSON feed for the specified key/ID. 
 * Once loaded, it calls cm_loadMapJSON.
 */
function getJSON(albumUrl) {

  // Retrieve the JSON feed.
  var script = document.createElement('script');

  script.setAttribute('src', albumUrl + 
                        '&alt=json-in-script&callback=loadAlbumJSON');
  script.setAttribute('id', 'jsonScript');
  script.setAttribute('type', 'text/javascript');
  document.documentElement.firstChild.appendChild(script);
}

function loadAlbumJSON(json) {
  var waypoints = [];
  for (var i = 0; i < json.feed.entry.length; i++) {
    var entry = json.feed.entry[i];
    var pos = entry["georss$where"]["gml$Point"]["gml$pos"].$t;
    var lat = parseFloat(pos.split(" ")[0]);
    var lng = parseFloat(pos.split(" ")[1]);
    var latlng = new GLatLng(lat, lng);
    waypoints.push(latlng);
  }
  var directions = new GDirections(map, document.getElementById("panel"));
  directions.loadFromWaypoints(waypoints);
}
</script>
  </head>

  <body onload="onLoad()">

    <div id="map" style="width: 500px; height: 480px; border: 1px solid black;"></div>
    </div>
    <br/>
    <div id="panel"></div>
  </body>
</html>
