<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"  xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <title>Google Maps API - Directions Example (directionsSimple.html)</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAAjU0EJWnWPMv7oQ-jjS7dYxSPW5CJgpdgO_s4yyMovOaVh_KvvhSfpvagV18eOyDWu7VytS6Bi1CWxw"
      type="text/javascript"></script>
    <style type="text/css">
      v\:* {
        behavior:url(#default#VML);
      }
    </style>
    <script type="text/javascript"> 

    var map;
    var directionsPanel;
    var polyPoints;
    var polyShape;
    var lastMarker;
    var startPoint;
    var endPoint;
    var markerStart;
    var markerEnd;
    var totalArea;
    var directions;

    function onLoad() {
      polyPoints = [];
      map = new GMap2(document.getElementById("map"));
      directionsPanel = document.getElementById("route");
      map.setCenter(new GLatLng(37.49975,-122.2629), 15);
      directions = new GDirections(null, null);
      var bounds = map.getBounds();
      var southWest = bounds.getSouthWest();
      var northEast = bounds.getNorthEast();
      var northWest = new GLatLng(southWest.lat(), northEast.lng());
      var southEast = new GLatLng(northEast.lat(), southWest.lng());
      var poly = new GPolygon([southWest, southEast, northEast, northWest, southWest]);
      totalArea = poly.getArea();
      var lngSpan = northEast.lng() - southWest.lng();
      var latSpan = northEast.lat() - southWest.lat();
      startPoint = new GLatLng(southWest.lat() + latSpan * Math.random(),
                          southWest.lng() + lngSpan * Math.random());
      endPoint = new GLatLng(southWest.lat() + latSpan * Math.random(),
                          southWest.lng() + lngSpan * Math.random());
      GEvent.addListener(directions, "load", function() {
        var route = directions.getRoute(0);
        markerStart = new GMarker(route.getStep(0).getLatLng(), {icon: G_START_ICON});
        GLog.write(route.getNumSteps());
        markerEnd = new GMarker(route.getEndLatLng(), {icon: G_END_ICON});
        GEvent.addListener(markerEnd, "click", function() {
          polyPoints.push(markerEnd.getPoint());
          drawCoordinates();
        });
        map.addOverlay(markerStart);
        map.addOverlay(markerEnd);
        polyPoints.push(markerStart.getPoint());
      });
      directions.loadFromWaypoints([startPoint.toUrlValue(), endPoint.toUrlValue()], {getPolyline: true, getSteps: true});

      GEvent.addListener(map, "click", mapClick);
    }

    function loadDirections() {
      var route = directions.getRoute(0);
      var rtPoints = [];
      var dirPoly = directions.getPolyline();
      for (var i = (dirPoly.getVertexCount()-1); i >= 0; i--) {
        var dirPoint = dirPoly.getVertex(i);
        rtPoints.push(dirPoint);
      }
      var allPoints = polyPoints.concat(rtPoints);
      var dirShape = new GPolyline(rtPoints, "#00ff00");
      var allPolyShape = new GPolygon(allPoints, "#ff0000", 2, .2, "#ff0000", .2);
      map.addOverlay(dirShape);
      map.addOverlay(allPolyShape);
      var areaScore = 100 - (allPolyShape.getArea()/totalArea)*200;
      var lengthScore = 100 - (Math.abs(dirShape.getLength() - polyShape.getLength())/dirShape.getLength())*50; 
      GLog.write(areaScore + "," + lengthScore);
    }
      
    function mapClick(marker, clickedPoint) {
      polyPoints.push(clickedPoint);
      drawCoordinates();
     }

      // Clear current Map
      function clearMap(){
        polyPoints.length = 0;
      }

    // drawCoordinates
    function drawCoordinates(){
      map.removeOverlay(polyShape);
      map.removeOverlay(lastMarker);
      //Re-create Polyline/Polygon
      polyShape = new GPolyline(polyPoints);

      // Grab last point of polyPoints to add marker
      lastMarker = new GMarker(polyPoints[polyPoints.length -1]);
      map.addOverlay(lastMarker);
      map.addOverlay(polyShape);
    }

</script>

</head>

  <body onload="onLoad()">

    <div id="map" style="width: 74%; height: 480px; float:left; border: 1px solid black;"></div>
    <div id="route" style="width: 25%; height:480px; float:right; border; 1px solid black;"></div>
    <br/>
    <a href="#" onclick="loadDirections()">load directions</a>
  </body>
</html>
